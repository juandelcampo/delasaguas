<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeLasAguas - SystemOS</title>
    
    <script src="https://w.soundcloud.com/player/api.js"></script>

    <style>
        /* --- RESET Y BASE OS --- */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        
        body, html {
            width: 100vw; height: 100vh; 
            background-color: #008080;
            background-image: url('https://static.boredpanda.com/blog/wp-content/uploads/2017/06/DSC00330-Edit-59391339deded__880.jpg');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            font-family: Tahoma, "Trebuchet MS", sans-serif;
            overflow: hidden; 
            font-size: 12px; 
        }

        /* --- PANTALLA DE LOGIN --- */
        #login-screen {
            position: fixed; inset: 0; background: #003399; z-index: 999999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; transition: opacity 0.5s ease; cursor: wait;
        }
        .login-box {
            display: flex; align-items: center; gap: 20px; background: rgba(0,0,0,0.2);
            padding: 30px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .login-box img { width: 70px; height: 70px; border-radius: 5px; border: 2px solid #fff; image-rendering: pixelated;}
        .login-text h1 { font-size: 24px; margin-bottom: 5px; font-weight: normal; font-style: italic;}
        .login-text p { font-size: 14px; color: #ccc; }

        /* WIDGET SOUNDCLOUD */
        #sc-widget-container { position: absolute; width: 1px; height: 1px; top: 0; left: 0; opacity: 0; pointer-events: none; z-index: -100; }

        /* --- ESCRITORIO E ICONOS --- */
        #desktop-area { height: calc(100vh - 38px); width: 100vw; position: relative; z-index: 1; }

        .desktop-icon {
            width: 90px; display: flex; flex-direction: column; align-items: center;
            text-align: center; color: white; cursor: pointer; position: absolute;
            text-shadow: 1px 1px 2px #000; gap: 5px; 
        }
        .desktop-icon img { width: 46px; height: 46px; filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5)); image-rendering: pixelated; pointer-events: none;}
        .desktop-icon span { padding: 2px 5px; border-radius: 2px; line-height: 1.2; font-size: 11px; pointer-events: none;}
        .desktop-icon:active span { background: #0b61ff; }
        .desktop-icon:active img { filter: brightness(0.5) sepia(1) hue-rotate(200deg) saturate(5); }

        /* --- MENUS CLIC DERECHO --- */
        .context-menu {
            position: absolute; background: #ece9d8; border: 1px solid #fff; border-right-color: #999; border-bottom-color: #999;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5); padding: 2px; z-index: 30000; display: none; flex-direction: column;
        }
        .ctx-item { padding: 6px 15px; cursor: pointer; color: #000; font-size: 11px; }
        .ctx-item:hover { background: #0b61ff; color: #fff; }
        .ctx-divider { height: 1px; background: #999; border-bottom: 1px solid #fff; margin: 2px 4px; }

        /* --- SALVAPANTALLAS --- */
        #screensaver {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 50000; display: none; overflow: hidden;
        }
        #ss-text { 
            position: absolute; font-size: 65px; font-weight: bold; 
            font-family: 'Comic Sans MS', 'Comic Sans', cursive; 
            color: #00ff00; white-space: nowrap; 
            text-shadow: 4px 4px 0px #ff00ff, -3px -3px 0px #00ffff;
        }

        /* --- SISTEMA DE VENTANAS --- */
        .window-container {
            position: absolute; background-color: #f4f4f4; border: 1px solid #111; border-radius: 6px 6px 0 0;
            box-shadow: 4px 4px 15px rgba(0,0,0,0.6); display: flex; flex-direction: column; overflow: hidden; resize: both; min-width: 350px; min-height: 250px;
        }
        .window-container.hidden { display: none !important; }
        .window-container.minimized { display: none !important; }
        .window-container.maximized { top: 0 !important; left: 0 !important; width: 100vw !important; height: calc(100vh - 38px) !important; border-radius: 0; resize: none; }

        .os-titlebar { background: linear-gradient(to bottom, #4a4a4a 0%, #2b2b2b 100%); padding: 4px 8px; height: 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #000; cursor: default; }
        .os-title { color: #eee; font-weight: bold; text-shadow: 1px 1px #000; display: flex; align-items: center; gap: 6px; font-size: 12px;}
        .os-title img { width: 16px; height: 16px; image-rendering: pixelated; }
        .os-controls { display: flex; gap: 3px; }
        .os-btn { width: 22px; height: 22px; border-radius: 3px; border: 1px solid #666; color: white; font-weight: bold; font-family: Arial; font-size: 12px; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: inset 0 -1px 2px rgba(0,0,0,0.5); }
        .os-btn-blue { background: linear-gradient(to bottom, #666, #333); }
        .os-btn-close { background: linear-gradient(to bottom, #c9402a, #8f1b0a); border-color: #e26f5d; }

        .os-explorer-body { display: flex; flex: 1; min-height: 0; border-top: 1px solid #666; background: #fff;}
        .os-sidebar-panel { width: 190px; background: linear-gradient(to bottom, #2b2b36, #1a1a24); padding: 15px; border-right: 1px solid #999; color: white; overflow-y: auto; }
        .os-sidebar-box { background: #ece9d8; border-radius: 3px; overflow: hidden; box-shadow: 1px 1px 3px rgba(0,0,0,0.5); margin-bottom: 15px; }
        .os-box-header { background: linear-gradient(to right, #ccc, #aaa); color: #000; font-weight: bold; padding: 5px 10px; font-size: 11px; border-bottom: 1px solid #999;}
        .os-box-content { padding: 10px; color: #000; font-size: 11px; background: #fff;}
        .sidebar-link { display: flex; align-items: center; gap: 6px; color: #0033cc; cursor: pointer; margin-bottom: 8px; font-size: 11px;}
        .sidebar-link:hover { color: #0077ff; text-decoration: underline; }
        .sidebar-link img { width: 14px; height: 14px; image-rendering: pixelated;}

        .os-main-content { flex: 1; padding: 25px; overflow-y: auto; background: #fdfdfd; }
        .notepad-body { flex: 1; display: flex; flex-direction: column; background: #fff; min-height: 0;}
        .notepad-menubar { background: #d0d0d0; padding: 4px 8px; border-bottom: 1px solid #999; display: flex; gap: 15px; font-size: 12px; }
        .notepad-textarea { flex: 1; border: none; resize: none; padding: 10px; font-family: 'Courier New', monospace; font-size: 14px; overflow-y: auto; outline: none; }

        /* VISOR MULTIMEDIA */
        .media-viewer-body { flex: 1; display: flex; flex-direction: column; background: #111; min-height: 0; }
        .media-content-area { flex: 1; display: flex; justify-content: center; align-items: center; padding: 0; min-height: 0; background: #000; position: relative;}
        .media-content-area iframe, .media-content-area img { width: 100%; height: 100%; object-fit: contain; border: none; display: none; }
        .media-viewer-toolbar { height: 45px; background: #ece9d8; border-top: 1px solid #fff; display: none; justify-content: center; align-items: center; gap: 20px; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); width: 100%; flex-shrink: 0; }
        .media-viewer-toolbar.active { display: flex; }
        .toolbar-btn { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #999; background: linear-gradient(to bottom, #fff, #ddd); font-size: 14px; cursor: pointer; display: flex; justify-content: center; align-items: center; color: #333; box-shadow: 1px 1px 3px rgba(0,0,0,0.3); transition: 0.1s; }
        .toolbar-btn:active { background: #ccc; box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5); transform: translateY(1px);}

        /* ICONOS DE ARCHIVO AMPLIADOS */
        .grid-files { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; align-items: start; }
        .file-item { display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; padding: 10px; border: 1px dotted transparent; border-radius: 4px; height: max-content;}
        .file-item:hover { background-color: #dbeaff; border-color: #9ac6ff; }
        .file-item img.file-thumb { width: 140px; height: 105px; object-fit: cover; border: 1px solid #ccc; padding: 2px; background: #fff; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
        .file-item img.file-icon-img { width: 48px; height: 48px; image-rendering: pixelated; }
        .file-item span { margin-top: 10px; font-size: 12px; word-break: break-word; color: #000; line-height: 1.2;}

        /* --- APP: PAINT RETRO MEJORADO --- */
        .paint-toolbar { background: #ece9d8; padding: 8px 10px; display: flex; flex-direction: column; gap: 8px; border-bottom: 2px solid #999; }
        .paint-row { display: flex; gap: 10px; align-items: center; font-size: 11px; }
        .color-btn { width: 20px; height: 20px; border: 2px outset #eee; cursor: pointer; border-radius: 0; box-sizing: border-box;}
        .color-btn.active { border: 2px inset #999; outline: 1px dotted #000; }
        .paint-action-btn { background: #ece9d8; border: 2px outset #eee; font-family: Tahoma; font-size: 11px; cursor: pointer; padding: 2px 8px; }
        .paint-action-btn:active { border: 2px inset #eee; }

        /* ========================================================
           CLON DE WINAMP
           ======================================================== */
        .winamp-window { background: #272832; border: 2px solid; border-color: #6d6d7c #000 #000 #6d6d7c; width: 420px; min-width: 380px; height: 320px; min-height: 280px; border-radius: 0; resize: both; box-shadow: 6px 6px 15px rgba(0,0,0,0.8); padding: 4px; display: flex; flex-direction: column; gap: 6px; overflow: hidden; }
        .wa-module { background: #2a2a35; padding: 12px; border: 1px solid #000; box-shadow: inset 1px 1px 1px #444; flex-shrink: 0;}
        .wa-titlebar { background: linear-gradient(to right, #1d1d29, #333346, #1d1d29); height: 20px; display: flex; justify-content: space-between; align-items: center; padding: 0 6px; border: 1px solid #000; cursor: default; margin-bottom: 2px; flex-shrink: 0;}
        .wa-title { font-family: Tahoma, sans-serif; font-size: 11px; color: #d3d3d3; font-weight: bold; letter-spacing: 2px; margin-left: 5px;}
        .wa-controls { display: flex; gap: 4px; }
        .wa-btn-close { width: 14px; height: 14px; background: #bbaaaa; border: 1px solid; border-color: #fff #555 #555 #fff; font-size: 10px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #000; font-weight: bold; }
        
        .wa-screen-container { background: #000; border: 2px inset #666; height: 75px; padding: 8px 12px; display: flex; gap: 15px; align-items: center; margin-bottom: 10px; }
        .wa-left-screen { display: flex; flex-direction: column; align-items: center; gap: 6px; }
        .wa-time { font-family: 'Courier New', monospace; font-size: 32px; color: #00ff00; font-weight: bold; line-height: 1; text-shadow: 0 0 5px #00ff00; letter-spacing: -1px;}
        .wa-visualizer { display: flex; align-items: flex-end; gap: 2px; height: 16px; width: 100%; border-bottom: 2px solid #003300; }
        .vis-bar { width: 8px; background: #00ff00; height: 3px; transition: height 0.1s; }
        .wa-visualizer.playing .vis-bar { animation: eq 0.4s infinite alternate ease-in-out; }
        .wa-visualizer .vis-bar:nth-child(1) { animation-duration: 0.3s; }
        .wa-visualizer .vis-bar:nth-child(2) { animation-duration: 0.5s; }
        .wa-visualizer .vis-bar:nth-child(3) { animation-duration: 0.2s; }
        .wa-visualizer .vis-bar:nth-child(4) { animation-duration: 0.6s; }
        .wa-visualizer .vis-bar:nth-child(5) { animation-duration: 0.4s; }
        .wa-visualizer .vis-bar:nth-child(6) { animation-duration: 0.7s; }
        @keyframes eq { 0% { height: 3px; } 100% { height: 100%; } }

        .wa-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; height: 100%; overflow: hidden;}
        .wa-title-scroll { font-family: 'Courier New', monospace; font-size: 14px; color: #00ff00; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; background: #002200; padding: 4px; border: 1px solid #004400; margin-bottom: 4px;}
        .wa-stats { font-family: 'Courier New', monospace; font-size: 12px; color: #00aa00; display: flex; gap: 12px;}

        .wa-slider-area { margin-bottom: 10px; padding: 0 5px; flex-shrink: 0;}
        .wa-timeline-text { display: flex; justify-content: space-between; font-family: 'Courier New', monospace; font-size: 12px; font-weight: bold; color: #00aa00; margin-bottom: 4px; }
        .wa-seek-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 14px; background: #050505; margin: 0; border: 2px inset #555; cursor: pointer; outline: none; }
        .wa-seek-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 30px; height: 16px; background: #C0C0C0; border: 2px solid; border-color: #fff #555 #555 #fff; cursor: pointer; }

        .wa-controls-area { display: flex; align-items: center; justify-content: space-between; padding-left: 5px; flex-shrink: 0;}
        .wa-buttons { display: flex; gap: 6px; }
        .wa-btn { background: linear-gradient(to bottom, #d6d3ce, #999); border: 2px solid; border-color: #fff #555 #555 #fff; height: 30px; width: 38px; font-size: 14px; font-weight: bold; cursor: pointer; color: #000; display: flex; justify-content: center; align-items: center; font-family: Arial; }
        .wa-btn:active { border-color: #555 #fff #fff #555; padding-top: 2px; padding-left: 2px; background: #a9a9a9;}
        .wa-btn.play { width: 45px; font-size: 18px; }

        .wa-volume-box { display: flex; align-items: center; gap: 6px; color: #00aa00; font-family: 'Courier New', monospace; font-size: 13px; font-weight: bold;}
        .wa-vol-slider { -webkit-appearance: none; appearance: none; width: 90px; height: 12px; background: #000; margin: 0; border: 2px inset #555; cursor: pointer; }
        .wa-vol-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 12px; height: 18px; background: #C0C0C0; border: 2px solid; border-color: #fff #555 #555 #fff; cursor: pointer; }

        .wa-playlist-module { background: #000; border: 2px inset #555; padding: 6px; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; min-height: 70px;}
        .wa-pl-item { font-family: 'Courier New', monospace; font-size: 13px; color: #00aa00; padding: 4px 6px; display: flex; justify-content: space-between; cursor: pointer;}
        .wa-pl-item:hover { background: #111; }
        .wa-pl-item.active { background: #002200; color: #00ff00; }

        /* ======================================================== */

        /* --- BARRA DE TAREAS --- */
        #taskbar { position: fixed; bottom: 0; left: 0; width: 100vw; height: 38px; background: linear-gradient(to bottom, #303030, #111); display: flex; align-items: center; z-index: 10000; border-top: 2px solid #555; }
        .start-btn { background: linear-gradient(to bottom, #0078D7, #00427a); color: white; font-weight: bold; font-size: 15px; font-style: italic; height: 100%; padding: 0 20px 0 15px; border: none; border-radius: 0 15px 15px 0; display: flex; align-items: center; gap: 8px; cursor: pointer; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); border-right: 1px solid #002244; }
        #taskbar-windows { flex: 1; display: flex; gap: 4px; padding: 0 10px; overflow: hidden; align-items: center; height: 100%;}
        .taskbar-item { background: linear-gradient(to bottom, #5a5a5a, #333); border: 1px solid #222; border-radius: 3px; color: white; padding: 0 10px; height: 28px; display: flex; align-items: center; gap: 8px; cursor: pointer; min-width: 100px; max-width: 180px; font-size: 12px; box-shadow: inset 1px 1px 1px rgba(255,255,255,0.1); }
        .taskbar-item.active { background: linear-gradient(to bottom, #222, #000); box-shadow: inset 0 2px 5px rgba(0,0,0,0.6); color: #ccc;}
        .tray-area { background: linear-gradient(to bottom, #222, #050505); height: 100%; border-left: 1px solid #444; padding: 0 15px; display: flex; align-items: center; gap: 15px; color: white; font-size: 12px; }

        /* --- MENÚ DE INICIO --- */
        #start-menu { position: fixed; bottom: 38px; left: 0; width: 320px; height: 420px; background: #fff; border: 1px solid #111; border-top-right-radius: 8px; box-shadow: 4px -4px 15px rgba(0,0,0,0.6); z-index: 10001; display: none; flex-direction: column; overflow: hidden; }
        .sm-header { background: linear-gradient(to bottom, #2b2b36, #1a1a24); height: 55px; display: flex; align-items: center; padding: 0 15px; gap: 12px; color: white; font-weight: bold; font-size: 15px; border-bottom: 2px solid #0078D7; }
        .sm-header img { width: 38px; height: 38px; border: 2px solid rgba(255,255,255,0.6); border-radius: 4px; }
        .sm-body { display: flex; flex: 1; }
        .sm-left { flex: 1; padding: 8px; display: flex; flex-direction: column; gap: 4px; background: #fff;}
        .sm-right { width: 140px; background: #e0e6ed; border-left: 1px solid #b5cbe6; padding: 8px; display: flex; flex-direction: column; gap: 4px; }
        .sm-item { display: flex; align-items: center; gap: 10px; padding: 10px; cursor: pointer; color: #000; border-radius: 4px;}
        .sm-item:hover { background: #0078D7; color: white; }
        .sm-item img { width: 28px; height: 28px; image-rendering: pixelated;}
        .sm-item span { font-size: 12px; font-weight: bold;}
        .sm-item p { font-size: 10px; color: #666; margin: 0;}
        .sm-footer { background: linear-gradient(to bottom, #4a4a4a, #2b2b2b); height: 45px; display: flex; justify-content: flex-end; align-items: center; padding: 0 15px; border-top: 1px solid #666; }
        .sm-footer-btn { display: flex; align-items: center; gap: 8px; color: white; font-size: 12px; cursor: pointer; padding: 5px 10px; border-radius: 3px;}
        .sm-footer-btn:hover { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <audio id="snd-trash" src="https://archive.org/download/WindowsXPStartup/Windows%20XP%20Recycle%20Bin.mp3"></audio>

    <div id="login-screen">
        <div class="login-box">
            <img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png">
            <div class="login-text">
                <h1>SystemOS</h1>
                <p>Iniciando sesión de DeLasAguas...</p>
            </div>
        </div>
    </div>

    <div id="sc-widget-container">
        <iframe id="sc-widget" allow="autoplay; encrypted-media" src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/juan-manuel-309/delasaguas-jam-08-2010&auto_play=false&enable_api=true" frameborder="0" width="100%" height="166"></iframe>
    </div>

    <div id="context-menu" class="context-menu" style="width: 180px;">
        <div class="ctx-item" onclick="changeBackground()">Cambiar fondo de pantalla</div>
        <div class="ctx-item" onclick="triggerScreensaver()">Iniciar Salvapantallas</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="location.reload()">Actualizar sistema</div>
    </div>

    <div id="restore-menu" class="context-menu" style="width: 120px;">
        <div class="ctx-item" style="font-weight: bold;" onclick="restoreVideo()">Restaurar</div>
    </div>

    <div id="screensaver">
        <div id="ss-text">DeLasAguas</div>
    </div>

    <div id="desktop-area">
        <div class="desktop-icon" style="top: 20px; left: 20px;" onclick="openWindow('notepad-leeme', 'LEEME.txt', 'https://win98icons.alexmeub.com/icons/png/notepad_file-0.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/notepad_file-0.png"><span>LEEME.txt</span>
        </div>
        <div class="desktop-icon" style="top: 110px; left: 20px;" onclick="openWindow('soundamp-player', 'Winamp', 'https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png"><span>Mi Música</span>
        </div>
        <div class="desktop-icon" style="top: 200px; left: 20px;" onclick="openWindow('folder-images', 'Mis Imágenes', 'https://win98icons.alexmeub.com/icons/png/directory_closed-4.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/directory_closed-4.png"><span>Mis Imágenes</span>
        </div>
        <div class="desktop-icon" style="top: 290px; left: 20px;" onclick="openWindow('folder-videos', 'Mis Videos', 'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png"><span>Mis Videos</span>
        </div>
        <div class="desktop-icon" style="top: 380px; left: 20px;" onclick="openWindow('paint-window', 'Paint', 'https://win98icons.alexmeub.com/icons/png/paint_file-0.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/paint_file-0.png"><span>MS Paint</span>
        </div>
        <div class="desktop-icon" id="icon-trash" style="bottom: 20px; right: 20px;" onclick="openWindow('folder-trash', 'Papelera', 'https://win98icons.alexmeub.com/icons/png/recycle_bin_full-4.png')">
            <img src="https://win98icons.alexmeub.com/icons/png/recycle_bin_full-4.png"><span>Papelera</span>
        </div>
    </div>


    <div id="paint-window" class="window-container hidden" style="top: 60px; left: 300px; width: 450px; height: 440px; z-index: 5000;">
        <div class="os-titlebar">
            <div class="os-title"><img src="https://win98icons.alexmeub.com/icons/png/paint_file-0.png"> Sin título - Paint</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('paint-window', event)">_</div>
                <div class="os-btn os-btn-close" onclick="closeWindow('paint-window', event)">X</div>
            </div>
        </div>
        <div class="paint-toolbar">
            <div class="paint-row">
                <span>Colores:</span>
                <div class="color-btn active" style="background: #000;" onclick="changePaintColor('#000', this)"></div>
                <div class="color-btn" style="background: #808080;" onclick="changePaintColor('#808080', this)"></div>
                <div class="color-btn" style="background: #f00;" onclick="changePaintColor('#f00', this)"></div>
                <div class="color-btn" style="background: #00f;" onclick="changePaintColor('#00f', this)"></div>
                <div class="color-btn" style="background: #0f0;" onclick="changePaintColor('#0f0', this)"></div>
                <div class="color-btn" style="background: #ff0;" onclick="changePaintColor('#ff0', this)"></div>
                <div class="color-btn" style="background: #00ffff;" onclick="changePaintColor('#00ffff', this)"></div>
                <div class="color-btn" style="background: #ff00ff;" onclick="changePaintColor('#ff00ff', this)"></div>
                <div class="color-btn" style="background: #fff;" onclick="changePaintColor('#fff', this)" title="Goma de borrar (Blanco)"></div>
            </div>
            <div class="paint-row">
                <span>Grosor:</span>
                <input type="range" min="1" max="25" value="5" oninput="changePaintSize(this.value)" style="width:80px; cursor:pointer;">
                <button class="paint-action-btn" onclick="clearPaint()" style="margin-left:auto;">Borrar lienzo</button>
                <button class="paint-action-btn" onclick="savePaint()">Guardar</button>
            </div>
        </div>
        <div class="os-main-content" style="padding:10px; background:#808080; display:flex; justify-content:center; align-items:center;">
            <canvas id="paint-canvas" width="400" height="300" style="background:#fff; border: 1px solid #000; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); cursor: crosshair;"></canvas>
        </div>
    </div>

    <div id="folder-trash" class="window-container hidden" style="top: 100px; left: 200px; width: 600px; height: 350px;">
        <div class="os-titlebar">
            <div class="os-title"><img src="https://win98icons.alexmeub.com/icons/png/recycle_bin_full-4.png"> Papelera de Reciclaje</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('folder-trash', event)">_</div>
                <div class="os-btn os-btn-close" onclick="closeWindow('folder-trash', event)">X</div>
            </div>
        </div>
        <div class="os-explorer-body">
            <div class="os-sidebar-panel">
                <div class="os-sidebar-box">
                    <div class="os-box-header">Tareas de la Papelera</div>
                    <div class="os-box-content">
                        <div class="sidebar-link" onclick="alert('No puedes escapar de tus errores.')">Vaciar Papelera</div>
                    </div>
                </div>
            </div>
            <div class="os-main-content grid-files" id="trash-grid" style="gap: 10px;">
                <div class="file-item" id="trashed-video" oncontextmenu="showRestoreMenu(event)">
                    <img class="file-thumb" src="https://img.youtube.com/vi/VkqwETnA510/hqdefault.jpg">
                    <span>FBLA.avi</span>
                </div>
            </div>
        </div>
    </div>

    <div id="notepad-leeme" class="window-container hidden" style="top: 50px; left: 550px; width: 450px; height: 350px;">
        <div class="os-titlebar">
            <div class="os-title"><img src="https://win98icons.alexmeub.com/icons/png/notepad_file-0.png"> LEEME.txt - Bloc de notas</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('notepad-leeme', event)">_</div>
                <div class="os-btn os-btn-blue" onclick="maximizeWindow('notepad-leeme', event)">□</div>
                <div class="os-btn os-btn-close" onclick="closeWindow('notepad-leeme', event)">X</div>
            </div>
        </div>
        <div class="notepad-body">
            <div class="notepad-menubar"><span>Archivo</span> <span>Edición</span> <span>Formato</span> <span>Ver</span> <span>Ayuda</span></div>
            <textarea class="notepad-textarea" readonly>DeLasAguas

Un laboratorio audiovisual que disolvió las fronteras entre la música y el videoarte.

Transitando libremente desde la bossa nova y el funk hasta la psicodelia y el stoner, sus presentaciones en vivo eran rituales ininterrumpidos de inmersión total.

Su legado se condensa en "Los sueños de Pellicciaro", un proyecto independiente donde el sonido, las proyecciones y la obra gráfica convergen en una sola pieza indivisible.</textarea>
        </div>
    </div>

    <div id="soundamp-player" class="window-container winamp-window hidden" style="top: 100px; left: 100px;">
        <div class="wa-titlebar">
            <div class="wa-title">SOUNDAMP 3.0</div>
            <div class="wa-controls">
                <div class="wa-btn-close" onclick="minimizeWindow('soundamp-player', event)">_</div>
                <div class="wa-btn-close" onclick="closeWindow('soundamp-player', event)">X</div>
            </div>
        </div>
        
        <div class="wa-module">
            <div class="wa-screen-container">
                <div class="wa-left-screen">
                    <div class="wa-time" id="wa-time-display">00:00</div>
                    <div class="wa-visualizer" id="visualizer">
                        <div class="vis-bar"></div><div class="vis-bar"></div><div class="vis-bar"></div><div class="vis-bar"></div><div class="vis-bar"></div><div class="vis-bar"></div>
                    </div>
                </div>
                <div class="wa-info">
                    <div class="wa-title-scroll" id="wa-title-marquee">1. DeLasAguas - El Largo (08-2010) *** </div>
                    <div class="wa-stats"><span>192 kbps</span> <span>44 kHz</span></div>
                </div>
            </div>
            
            <div class="wa-slider-area">
                <div class="wa-timeline-text"><span id="wa-current-time-line">00:00</span><span id="wa-total-time-line">10:01</span></div>
                <input type="range" class="wa-seek-slider" id="wa-seek-slider" min="0" max="100" value="0">
            </div>
            
            <div class="wa-controls-area">
                <div class="wa-buttons">
                    <button class="wa-btn" onclick="scStop()">|&lt;</button>
                    <button class="wa-btn play" onclick="scPlay()">►</button>
                    <button class="wa-btn" onclick="scPause()">||</button>
                    <button class="wa-btn" onclick="scStop()">■</button>
                    <button class="wa-btn" onclick="scStop()">&gt;|</button>
                </div>
                <div class="wa-volume-box">
                    <span>VOL</span>
                    <input type="range" class="wa-vol-slider" id="wa-vol-slider" min="0" max="100" value="100">
                </div>
            </div>
        </div>

        <div class="wa-module wa-playlist-module">
            <div class="wa-pl-item active" id="pl-1" onclick="scPlay()">
                <span>1. El Largo (Jam 08-2010)</span> <span>10:01</span>
            </div>
            </div>
    </div>

    <div id="folder-images" class="window-container hidden" style="top: 80px; left: 150px; width: 750px; height: 500px;">
        <div class="os-titlebar">
            <div class="os-title"><img src="https://win98icons.alexmeub.com/icons/png/directory_closed-4.png"> Mis Imágenes</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('folder-images', event)">_</div>
                <div class="os-btn os-btn-blue" onclick="maximizeWindow('folder-images', event)">□</div>
                <div class="os-btn os-btn-close" onclick="closeWindow('folder-images', event)">X</div>
            </div>
        </div>
        <div class="os-explorer-body">
            <div class="os-sidebar-panel">
                <div class="os-sidebar-box">
                    <div class="os-box-header">Otros lugares</div>
                    <div class="os-box-content">
                        <div class="sidebar-link" onclick="openWindow('folder-videos', 'Mis Videos', 'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png')"><img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png"> Mis Videos</div>
                        <div class="sidebar-link" onclick="openWindow('soundamp-player', 'SoundAmp', 'https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png')"><img src="https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png"> Mi Música</div>
                        <div class="sidebar-link" onclick="openWindow('notepad-leeme', 'LEEME.txt', 'https://win98icons.alexmeub.com/icons/png/notepad_file-0.png')"><img src="https://win98icons.alexmeub.com/icons/png/notepad_file-0.png"> LEEME.txt</div>
                    </div>
                </div>
            </div>
            <div class="os-main-content grid-files">
                <div class="file-item" onclick="openImage(0)">
                    <img class="file-thumb" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPsdaTj9ebqPIdCv8cc0ofCD7OjIh7y264BCYUvoTINijmxaU6LJVrMgh1lpkAD1bH-Wn62BIWjQczsNkF8cHSakDbgeLFDdnUhZyZhzOgVYSqu9phnU4HutjuZOCgHjt6Dk2Vs9kUDnw/s1600/Dla_prov.jpg" referrerpolicy="no-referrer">
                    <span>Dla_prov.jpg</span>
                </div>
                <div class="file-item" onclick="openImage(1)">
                    <img class="file-thumb" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg_JczWFySWlfOX7f5xAELbDkjKwvgxlWwgPnmdD5DTvnp_zicjcrshyphenhyphen78lee2I-MEP2LglMxmBo-Jpgf4BPRRLFs6C0CfjXKdSQW5T9Rf9XRCUG6FbC86Wsx30W_Q3uKKdp1az7h3cvpw/s1600/EPR.jpg" referrerpolicy="no-referrer">
                    <span>EPR.jpg</span>
                </div>
                 <div class="file-item" onclick="openImage(2)">
                    <img class="file-thumb" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHuIyhlzrd5RO2p7NVkoIBJ06uSDTtIzCQ_Pe6ctGmPtJ8_7Np7CLlAOIbXQRtsa09hyphenhyphenVQObMuVTSNRDJpgU9h5-DyNAWEvPRXyCw_OolRyC6KqGyl3kQUSWQDLFXhF9qwWHbRem3S_cs/s1600/De+las+Aguas.jpg" referrerpolicy="no-referrer">
                    <span>De_las_Aguas.jpg</span>
                </div>
                <div class="file-item" onclick="openImage(3)">
                    <img class="file-thumb" src="https://iili.io/qfCtFrg.jpg" referrerpolicy="no-referrer">
                    <span>Samurai.jpg</span>
                </div>
                <div class="file-item" onclick="openImage(4)">
                    <img class="file-thumb" src="https://iili.io/qfCD3t2.jpg" referrerpolicy="no-referrer">
                    <span>Koala.jpg</span>
                </div>
            </div>
        </div>
    </div>

    <div id="folder-videos" class="window-container hidden" style="top: 130px; left: 250px; width: 750px; height: 500px;">
        <div class="os-titlebar">
            <div class="os-title"><img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png"> Mis Videos</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('folder-videos', event)">_</div>
                <div class="os-btn os-btn-blue" onclick="maximizeWindow('folder-videos', event)">□</div>
                <div class="os-btn os-btn-close" onclick="closeWindow('folder-videos', event)">X</div>
            </div>
        </div>
        <div class="os-explorer-body">
            <div class="os-sidebar-panel">
                <div class="os-sidebar-box">
                    <div class="os-box-header">Otros lugares</div>
                    <div class="os-box-content">
                        <div class="sidebar-link" onclick="openWindow('folder-images', 'Mis Imágenes', 'https://win98icons.alexmeub.com/icons/png/directory_closed-4.png')"><img src="https://win98icons.alexmeub.com/icons/png/directory_closed-4.png"> Mis Imágenes</div>
                        <div class="sidebar-link" onclick="openWindow('soundamp-player', 'SoundAmp', 'https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png')"><img src="https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png"> Mi Música</div>
                        <div class="sidebar-link" onclick="openWindow('notepad-leeme', 'LEEME.txt', 'https://win98icons.alexmeub.com/icons/png/notepad_file-0.png')"><img src="https://win98icons.alexmeub.com/icons/png/notepad_file-0.png"> LEEME.txt</div>
                    </div>
                </div>
            </div>
            <div class="os-main-content grid-files" id="videos-grid">
                <div class="file-item" onclick="openVideo('KVc3yQr89to', 'NuevoDía.avi')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/KVc3yQr89to/hqdefault.jpg"><span>NuevoDía.avi</span>
                </div>
                <div class="file-item" onclick="openVideo('MEvLUSr2e9Y', 'Lección7.wmv')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/MEvLUSr2e9Y/hqdefault.jpg"><span>Lección7.wmv</span>
                </div>
                <div class="file-item" onclick="openVideo('bTNAxV6jn2Y', 'Lección11_vivo.mpg')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/bTNAxV6jn2Y/hqdefault.jpg"><span>Lección11_vivo.mpg</span>
                </div>
                 <div class="file-item" onclick="openVideo('8hLqNGp78b8', 'MillonesDeSonidos.avi')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/8hLqNGp78b8/hqdefault.jpg"><span>MillonesDeSonidos.avi</span>
                </div>
                 <div class="file-item" onclick="openVideo('hwLEuHiV1kE', 'Fine.mp4')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/hwLEuHiV1kE/hqdefault.jpg"><span>Fine.mp4</span>
                </div>
                 <div class="file-item" onclick="openVideo('qiNnFuErDOw', 'Porno.avi')">
                    <img class="file-thumb" src="https://img.youtube.com/vi/qiNnFuErDOw/hqdefault.jpg"><span>Porno.avi</span>
                </div>
            </div>
        </div>
    </div>

    <div id="media-viewer" class="window-container hidden" style="top: 50px; left: 100px; width: 800px; height: 550px; z-index: 1000;">
        <div class="os-titlebar">
            <div class="os-title" id="media-title"><img src="https://win98icons.alexmeub.com/icons/png/video_file-0.png"> Reproductor</div>
            <div class="os-controls">
                <div class="os-btn os-btn-blue" onclick="minimizeWindow('media-viewer', event)">_</div>
                <div class="os-btn os-btn-blue" onclick="maximizeWindow('media-viewer', event)">□</div>
                <div class="os-btn os-btn-close" onclick="closeViewer(event)">X</div>
            </div>
        </div>
        <div class="media-viewer-body">
            <div class="media-content-area">
                <iframe id="viewer-iframe" src="" allow="autoplay; encrypted-media; picture-in-picture; fullscreen" allowfullscreen style="display:none; width: 100%; height: 100%; border: none;"></iframe>
                <img id="viewer-image" src="" style="display:none;" referrerpolicy="no-referrer">
            </div>
            <div class="media-viewer-toolbar" id="media-viewer-toolbar">
                <button class="toolbar-btn" onclick="prevImage()" title="Anterior">◄</button>
                <button class="toolbar-btn" onclick="nextImage()" title="Siguiente">►</button>
            </div>
        </div>
    </div>

    <div id="start-menu" class="hidden">
        <div class="sm-header">
            <img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png" style="image-rendering: pixelated;">
            <span>Usuario Local</span>
        </div>
        <div class="sm-body">
            <div class="sm-left">
                <div class="sm-item" onclick="openWindow('soundamp-player', 'SoundAmp', 'https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png'); toggleStartMenu(event)">
                    <img src="https://win98icons.alexmeub.com/icons/png/cd_audio_cd_a-3.png">
                    <div><span>Reproductor de Música</span><p>SoundAmp 3.0</p></div>
                </div>
                <div class="sm-item" onclick="openWindow('paint-window', 'Paint', 'https://win98icons.alexmeub.com/icons/png/paint_file-0.png'); toggleStartMenu(event)">
                    <img src="https://win98icons.alexmeub.com/icons/png/paint_file-0.png">
                    <div><span>MS Paint</span><p>Dibujo libre</p></div>
                </div>
                <div class="sm-item" onclick="openWindow('notepad-leeme', 'LEEME.txt', 'https://win98icons.alexmeub.com/icons/png/notepad_file-0.png'); toggleStartMenu(event)">
                    <img src="https://win98icons.alexmeub.com/icons/png/notepad_file-0.png">
                    <div><span>Bloc de notas</span><p>Editor de texto</p></div>
                </div>
            </div>
            <div class="sm-right">
                <div class="sm-item" onclick="openWindow('folder-videos', 'Mis Videos', 'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png'); toggleStartMenu(event)"><span>Mis Videos</span></div>
                <div class="sm-item" onclick="openWindow('folder-images', 'Mis Imágenes', 'https://win98icons.alexmeub.com/icons/png/directory_closed-4.png'); toggleStartMenu(event)"><span>Mis Imágenes</span></div>
            </div>
        </div>
        <div class="sm-footer">
            <div class="sm-footer-btn" onclick="location.reload()"><img src="https://win98icons.alexmeub.com/icons/png/shut_down_normal-0.png"> Reiniciar equipo</div>
        </div>
    </div>

    <div id="taskbar">
        <button class="start-btn" id="start-btn" onclick="toggleStartMenu(event)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5)); pointer-events: none;">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
            </svg>
            Inicio
        </button>
        
        <div id="taskbar-windows"></div>

        <div class="tray-area">
            <span id="clock">10:30 AM</span>
        </div>
    </div>

    <script>
        // --- 0. ARRANQUE INSTANTÁNEO Y LOGIN ---
        window.onload = () => {
            initPaint();

            setTimeout(() => {
                const login = document.getElementById('login-screen');
                login.style.opacity = '0';
                setTimeout(() => { login.style.display = 'none'; }, 500);
                
                openWindow('folder-images', 'Mis Imágenes', 'https://win98icons.alexmeub.com/icons/png/directory_closed-4.png');
                openWindow('folder-videos', 'Mis Videos', 'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png');
                openWindow('notepad-leeme', 'LEEME.txt', 'https://win98icons.alexmeub.com/icons/png/notepad_file-0.png');
            }, 2000);

            document.querySelectorAll('.desktop-icon').forEach(icon => {
                makeIconDraggable(icon);
            });
        };

        // --- ICONOS DE ESCRITORIO ARRASTRABLES ---
        function makeIconDraggable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // --- MENU CLIC DERECHO & FONDO DE PANTALLA ---
        const bgImages = [
            "https://static.boredpanda.com/blog/wp-content/uploads/2017/06/DSC00330-Edit-59391339deded__880.jpg",
            "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPsdaTj9ebqPIdCv8cc0ofCD7OjIh7y264BCYUvoTINijmxaU6LJVrMgh1lpkAD1bH-Wn62BIWjQczsNkF8cHSakDbgeLFDdnUhZyZhzOgVYSqu9phnU4HutjuZOCgHjt6Dk2Vs9kUDnw/s1600/Dla_prov.jpg",
            "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg_JczWFySWlfOX7f5xAELbDkjKwvgxlWwgPnmdD5DTvnp_zicjcrshyphenhyphen78lee2I-MEP2LglMxmBo-Jpgf4BPRRLFs6C0CfjXKdSQW5T9Rf9XRCUG6FbC86Wsx30W_Q3uKKdp1az7h3cvpw/s1600/EPR.jpg",
            "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHuIyhlzrd5RO2p7NVkoIBJ06uSDTtIzCQ_Pe6ctGmPtJ8_7Np7CLlAOIbXQRtsa09hyphenhyphenVQObMuVTSNRDJpgU9h5-DyNAWEvPRXyCw_OolRyC6KqGyl3kQUSWQDLFXhF9qwWHbRem3S_cs/s1600/De+las+Aguas.jpg",
            "https://iili.io/qfCtFrg.jpg",
            "https://iili.io/qfCD3t2.jpg"
        ];
        let bgIndex = 0;

        document.getElementById('desktop-area').addEventListener('contextmenu', (e) => {
            if(e.target.id === 'desktop-area') {
                e.preventDefault();
                const ctx = document.getElementById('context-menu');
                ctx.style.display = 'flex';
                ctx.style.left = e.pageX + 'px';
                ctx.style.top = e.pageY + 'px';
            }
        });

        function showRestoreMenu(e) {
            e.preventDefault();
            e.stopPropagation();
            const rMenu = document.getElementById('restore-menu');
            rMenu.style.display = 'flex';
            rMenu.style.left = e.pageX + 'px';
            rMenu.style.top = e.pageY + 'px';
            document.getElementById('context-menu').style.display = 'none'; 
        }

        function restoreVideo() {
            document.getElementById('restore-menu').style.display = 'none';
            const trashedVid = document.getElementById('trashed-video');
            if(trashedVid) {
                trashedVid.remove();
                
                document.querySelector('#icon-trash img').src = 'https://win98icons.alexmeub.com/icons/png/recycle_bin_empty-4.png';
                document.querySelector('#folder-trash .os-title img').src = 'https://win98icons.alexmeub.com/icons/png/recycle_bin_empty-4.png';
                
                const videoGrid = document.getElementById('videos-grid');
                const newVid = document.createElement('div');
                newVid.className = 'file-item';
                newVid.onclick = () => openVideo('VkqwETnA510', 'FBLA.avi');
                newVid.innerHTML = `
                    <img class="file-thumb" src="https://img.youtube.com/vi/VkqwETnA510/hqdefault.jpg">
                    <span>FBLA.avi</span>
                `;
                videoGrid.appendChild(newVid);
                
                const trashSound = document.getElementById('snd-trash');
                trashSound.currentTime = 0;
                trashSound.play().catch(()=>{});
            }
        }

        function changeBackground() {
            bgIndex = (bgIndex + 1) % bgImages.length;
            document.body.style.backgroundImage = `url('${bgImages[bgIndex]}')`;
            if (bgIndex === 0) {
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundRepeat = 'no-repeat';
            } else {
                document.body.style.backgroundSize = 'auto'; 
                document.body.style.backgroundRepeat = 'repeat'; 
            }
            document.getElementById('context-menu').style.display = 'none';
        }

        // --- SALVAPANTALLAS COMIC SANS ---
        let idleTime = 0;
        const ss = document.getElementById('screensaver');
        const ssLogo = document.getElementById('ss-text');
        let dx = 4, dy = 4, ssX = window.innerWidth/2, ssY = window.innerHeight/2;

        function triggerScreensaver() {
            ss.style.display = 'block';
            document.getElementById('context-menu').style.display = 'none';
            animateScreensaver();
        }

        function animateScreensaver() {
            if(ss.style.display === 'none') return;
            
            let hit = false;
            if(ssX <= 0 || ssX + ssLogo.offsetWidth >= window.innerWidth) { dx = -dx; hit = true; }
            if(ssY <= 0 || ssY + ssLogo.offsetHeight >= window.innerHeight) { dy = -dy; hit = true; }
            
            ssX += dx; ssY += dy;
            ssLogo.style.left = ssX + 'px'; 
            ssLogo.style.top = ssY + 'px';

            if (hit) { ssLogo.style.color = `hsl(${Math.random()*360}, 100%, 50%)`; }
            
            requestAnimationFrame(animateScreensaver);
        }

        document.addEventListener('mousemove', () => { idleTime = 0; ss.style.display = 'none'; });
        document.addEventListener('keydown', () => { idleTime = 0; ss.style.display = 'none'; });
        setInterval(() => { idleTime++; if (idleTime >= 60 && ss.style.display === 'none') triggerScreensaver(); }, 1000);


        // --- LÓGICA DE VENTANAS Y BARRA DE TAREAS ---
        let zIndexCounter = 100;
        const activeWindows = {};

        function openWindow(id, title, iconSrc) {
            const win = document.getElementById(id);
            win.classList.remove('hidden', 'minimized');
            win.style.zIndex = ++zIndexCounter;

            if (!activeWindows[id]) {
                activeWindows[id] = true;
                const tbContainer = document.getElementById('taskbar-windows');
                const btn = document.createElement('div');
                btn.className = 'taskbar-item active';
                btn.id = 'taskbar-btn-' + id;
                btn.innerHTML = `<img src="${iconSrc}" width="16"> <span>${title}</span>`;
                btn.onclick = () => toggleWindow(id);
                tbContainer.appendChild(btn);
            }
            updateTaskbar();
        }

        function closeWindow(id, e) {
            if (e) e.stopPropagation(); 
            const win = document.getElementById(id);
            win.classList.add('hidden');
            win.classList.remove('maximized');
            
            if (activeWindows[id]) {
                delete activeWindows[id];
                document.getElementById('taskbar-btn-' + id).remove();
            }

            if (id === 'soundamp-player') scStop();
            updateTaskbar();
        }

        function minimizeWindow(id, e) {
            if (e) e.stopPropagation();
            document.getElementById(id).classList.add('minimized');
            updateTaskbar();
        }

        function maximizeWindow(id, e) {
            if (e) e.stopPropagation();
            document.getElementById(id).classList.toggle('maximized');
        }

        function toggleWindow(id) {
            const win = document.getElementById(id);
            if (win.classList.contains('minimized')) {
                win.classList.remove('minimized'); win.style.zIndex = ++zIndexCounter;
            } else {
                if (parseInt(win.style.zIndex) === zIndexCounter) win.classList.add('minimized'); 
                else win.style.zIndex = ++zIndexCounter; 
            }
            updateTaskbar();
        }

        function updateTaskbar() {
            for (let id in activeWindows) {
                const btn = document.getElementById('taskbar-btn-' + id);
                const win = document.getElementById(id);
                if (btn && win) {
                    if (!win.classList.contains('minimized') && parseInt(win.style.zIndex) === zIndexCounter) btn.classList.add('active');
                    else btn.classList.remove('active');
                }
            }
        }

        function makeDraggableWindow(win) {
            const titlebar = win.querySelector('.os-titlebar') || win.querySelector('.wa-titlebar');
            if (!titlebar) return;

            win.addEventListener('mousedown', () => { win.style.zIndex = ++zIndexCounter; updateTaskbar(); });

            titlebar.addEventListener('mousedown', (e) => {
                if(e.target.closest('.os-controls') || e.target.closest('.wa-controls') || e.target.closest('.paint-toolbar')) return;
                if(win.classList.contains('maximized')) return;
                e.preventDefault();
                let pos3 = e.clientX, pos4 = e.clientY;
                
                function elementDrag(e2) {
                    e2.preventDefault();
                    let newTop = win.offsetTop - (pos4 - e2.clientY);
                    let newLeft = win.offsetLeft - (pos3 - e2.clientX);
                    pos3 = e2.clientX; pos4 = e2.clientY;
                    
                    const maxLeft = window.innerWidth - 80; 
                    const maxTop = window.innerHeight - 38 - 30;
                    win.style.top = Math.max(0, Math.min(newTop, maxTop)) + "px";
                    win.style.left = Math.max(-win.offsetWidth + 80, Math.min(newLeft, maxLeft)) + "px";
                }
                function closeDragElement() { document.removeEventListener('mouseup', closeDragElement); document.removeEventListener('mousemove', elementDrag); }
                document.addEventListener('mouseup', closeDragElement); document.addEventListener('mousemove', elementDrag);
            });
        }
        document.querySelectorAll('.window-container').forEach(win => { makeDraggableWindow(win); });


        // --- MENU DE INICIO Y CLICK GLOBAL ---
        function toggleStartMenu(e) { 
            if(e) e.stopPropagation();
            const sm = document.getElementById('start-menu');
            const btn = document.getElementById('start-btn');
            sm.style.display = sm.style.display === 'flex' ? 'none' : 'flex';
            btn.classList.toggle('active');
            document.getElementById('context-menu').style.display = 'none';
            document.getElementById('restore-menu').style.display = 'none';
        }
        
        document.addEventListener('click', (e) => {
            const sm = document.getElementById('start-menu');
            const btn = document.getElementById('start-btn');
            if (sm.style.display === 'flex' && !sm.contains(e.target) && !e.target.closest('#start-btn')) {
                sm.style.display = 'none'; btn.classList.remove('active');
            }
            if (e.target.id !== 'desktop-area' && !e.target.closest('#trashed-video')) {
                document.getElementById('context-menu').style.display = 'none';
                document.getElementById('restore-menu').style.display = 'none';
            }
        });


        // --- APP: MS PAINT BÁSICO MEJORADO ---
        let painting = false;
        let paintColor = '#000000';
        let paintSize = 5;
        let paintCanvas, pCtx;

        function initPaint() {
            paintCanvas = document.getElementById('paint-canvas');
            pCtx = paintCanvas.getContext('2d');
            clearPaint(); 
            
            paintCanvas.addEventListener('mousedown', startPosition);
            paintCanvas.addEventListener('mouseup', endPosition);
            paintCanvas.addEventListener('mousemove', draw);
            paintCanvas.addEventListener('mouseleave', endPosition);
        }

        function startPosition(e) { painting = true; draw(e); }
        function endPosition() { painting = false; pCtx.beginPath(); }
        
        function draw(e) {
            if(!painting) return;
            const rect = paintCanvas.getBoundingClientRect();
            let x = e.clientX - rect.left; 
            let y = e.clientY - rect.top;
            
            pCtx.lineWidth = paintSize;
            pCtx.lineCap = 'round';
            pCtx.strokeStyle = paintColor;
            
            pCtx.lineTo(x, y);
            pCtx.stroke();
            pCtx.beginPath();
            pCtx.moveTo(x, y);
        }
        
        function changePaintColor(c, el) { 
            paintColor = c; 
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            if(el) el.classList.add('active');
        }
        
        function changePaintSize(val) { paintSize = val; }
        
        function clearPaint() { 
            pCtx.fillStyle = "#ffffff"; 
            pCtx.fillRect(0, 0, paintCanvas.width, paintCanvas.height); 
        }

        function savePaint() {
            const link = document.createElement('a');
            link.download = 'obra_maestra.png';
            link.href = paintCanvas.toDataURL();
            link.click();
        }


        // --- LÓGICA SOUNDAMP (10:01 Forzado visualmente) ---
        const widget = SC.Widget(document.getElementById('sc-widget'));
        const timeDisplay = document.getElementById('wa-time-display');
        const progressBar = document.getElementById('wa-progress-fill');
        const visualizer = document.getElementById('visualizer');
        const seekSlider = document.getElementById('wa-seek-slider');
        const currentTimeLine = document.getElementById('wa-current-time-line');
        
        let trackDuration = 0;
        let isSeeking = false;

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const m = Math.floor(totalSeconds / 60);
            const s = totalSeconds % 60;
            return `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
        }

        widget.bind(SC.Widget.Events.READY, () => {
            widget.getDuration((d) => { trackDuration = d; });
        });

        widget.bind(SC.Widget.Events.PLAY, () => { visualizer.classList.add('playing'); });
        widget.bind(SC.Widget.Events.PAUSE, () => { visualizer.classList.remove('playing'); });
        
        widget.bind(SC.Widget.Events.PLAY_PROGRESS, (data) => {
            const f = formatTime(data.currentPosition);
            timeDisplay.innerText = f; currentTimeLine.innerText = f; 
            
            if (trackDuration === 0) widget.getDuration((d) => { trackDuration = d; });
            if(trackDuration > 0 && !isSeeking) {
                seekSlider.value = (data.currentPosition / trackDuration) * 100;
            }
        });

        function scPlay() { widget.play(); }
        function scPause() { widget.pause(); }
        function scStop() { widget.pause(); widget.seekTo(0); timeDisplay.innerText = "00:00"; currentTimeLine.innerText = "00:00"; seekSlider.value = 0; }
        
        seekSlider.addEventListener('mousedown', () => isSeeking = true);
        seekSlider.addEventListener('mouseup', () => isSeeking = false);
        seekSlider.addEventListener('change', (e) => {
            if (trackDuration > 0) widget.seekTo((e.target.value / 100) * trackDuration);
        });
        document.getElementById('wa-vol-slider').addEventListener('input', (e) => widget.setVolume(e.target.value));


        // --- VISOR MULTIMEDIA Y GALERÍA ---
        const imageGallery = [
            { src: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPsdaTj9ebqPIdCv8cc0ofCD7OjIh7y264BCYUvoTINijmxaU6LJVrMgh1lpkAD1bH-Wn62BIWjQczsNkF8cHSakDbgeLFDdnUhZyZhzOgVYSqu9phnU4HutjuZOCgHjt6Dk2Vs9kUDnw/s1600/Dla_prov.jpg", title: "Dla_prov.jpg" },
            { src: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg_JczWFySWlfOX7f5xAELbDkjKwvgxlWwgPnmdD5DTvnp_zicjcrshyphenhyphen78lee2I-MEP2LglMxmBo-Jpgf4BPRRLFs6C0CfjXKdSQW5T9Rf9XRCUG6FbC86Wsx30W_Q3uKKdp1az7h3cvpw/s1600/EPR.jpg", title: "EPR.jpg" },
            { src: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHuIyhlzrd5RO2p7NVkoIBJ06uSDTtIzCQ_Pe6ctGmPtJ8_7Np7CLlAOIbXQRtsa09hyphenhyphenVQObMuVTSNRDJpgU9h5-DyNAWEvPRXyCw_OolRyC6KqGyl3kQUSWQDLFXhF9qwWHbRem3S_cs/s1600/De+las+Aguas.jpg", title: "De_las_Aguas.jpg" },
            { src: "https://iili.io/qfCtFrg.jpg", title: "Samurai.jpg" },
            { src: "https://iili.io/qfCD3t2.jpg", title: "Koala.jpg" }
        ];
        let currentImageIndex = 0;

        function openVideo(src, title) {
            scPause(); 
            document.getElementById('media-title').innerHTML = `<img src="https://win98icons.alexmeub.com/icons/png/video_file-0.png"> Reproductor Multimedia - ${title}`;
            document.getElementById('viewer-image').style.display = 'none';
            document.getElementById('media-viewer-toolbar').style.display = 'none'; 
            document.getElementById('viewer-iframe').style.display = 'block';
            document.getElementById('viewer-iframe').src = `https://www.youtube.com/embed/${src}?autoplay=1&rel=0`;
            openWindow('media-viewer', title, 'https://win98icons.alexmeub.com/icons/png/video_file-0.png');
        }

        function openImage(index) {
            currentImageIndex = index;
            const imgObj = imageGallery[index];
            document.getElementById('media-title').innerHTML = `<img src="https://win98icons.alexmeub.com/icons/png/image_file-0.png"> Visor de Imágenes - ${imgObj.title}`;
            document.getElementById('viewer-iframe').style.display = 'none';
            document.getElementById('viewer-iframe').src = ""; 
            document.getElementById('viewer-image').style.display = 'block';
            document.getElementById('viewer-image').src = imgObj.src;
            document.getElementById('media-viewer-toolbar').style.display = 'flex'; 
            openWindow('media-viewer', imgObj.title, 'https://win98icons.alexmeub.com/icons/png/image_file-0.png');
        }

        function prevImage() { if(currentImageIndex > 0) openImage(currentImageIndex - 1); else openImage(imageGallery.length - 1); }
        function nextImage() { if(currentImageIndex < imageGallery.length - 1) openImage(currentImageIndex + 1); else openImage(0); }
        function closeViewer(e) { closeWindow('media-viewer', e); setTimeout(() => { document.getElementById('viewer-iframe').src = ''; }, 300); }

        // --- RELOJ ---
        setInterval(() => {
            const n = new Date();
            let hours = n.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12; hours = hours ? hours : 12; 
            document.getElementById('clock').innerText = `${hours}:${minutes} ${ampm}`;
        }, 1000);

    </script>
</body>
</html>